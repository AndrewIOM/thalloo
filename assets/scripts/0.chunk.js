(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{28:function(e,t,n){"use strict";ko.bindingHandlers.slider={init:function(e,t,n,r,a){var i=r;null!=i.currentSlice()&&(noUiSlider.create(e,{start:[-9999,9999],range:{min:i.currentSlice().min,max:i.currentSlice().max},connect:!0,behaviour:"tap-drag",step:1}),e.noUiSlider.on("slide",function(e,t){var n=e[t];t?i.currentSliceMax(n):i.currentSliceMin(n)}))},update:function(e,t,n,r,a){var i;null==r.currentSlice()?null!=(i=document.getElementById("slicer"))&&i.setAttribute("disabled","true"):e.innerHTML.length>0?(!function(e,t){var n=document.getElementById("slicer");null!=n&&n.noUiSlider.updateOptions({range:{min:e,max:t}})}(Number(r.currentSlice().min),Number(r.currentSlice().max)),null!=(i=document.getElementById("slicer"))&&i.removeAttribute("disabled")):(!function(e,t){var n=t;if(null==n.currentSlice())return;noUiSlider.create(e,{start:[-9999,9999],range:{min:Number(n.currentSlice().min),max:Number(n.currentSlice().max)},connect:!0,behaviour:"tap-drag",step:1}),e.noUiSlider.on("slide",function(e,t){var r=e[t];t?n.currentSliceMax(r):n.currentSliceMin(r)})}(e,r),null!=(i=document.getElementById("slicer"))&&i.removeAttribute("disabled"))}},ko.bindingHandlers.truncatedText={update:function(e,t,n){var r=ko.utils.unwrapObservable(t()),a=ko.utils.unwrapObservable(n().maxTextLength)||20;r.length>a&&r.substring(0,a);ko.bindingHandlers.text.update=e}}},87:function(e,t,n){"use strict";n.r(t);n(28);var r,a=n(2),i=n(1),o=n(12),s=n(13),l=n(26),c=n(4);!function(e){e.SELECTED_POINTS="selectedPoints"}(r||(r={}));var u,d,p,f,h,m=function(){return function(e,t){var n=this;if(this.zoomIn=function(){n._zoom.scaleBy(n._svg.transition().duration(750),1.3)},this.zoomOut=function(){n._zoom.scaleBy(n._svg.transition().duration(750),1/1.3)},this.loadBaseLayers=function(e){i.map(n._config.BaseLayers,function(t){return n.loadBaseLayer(t,n._layers.BackgroundLayers,e)})},this.loadBaseLayer=function(e,t,n){var r=a.g("../layers/"+e.File+".json"),i=a.g("../layers/"+e.File+".palette.json");r.then(function(r){var o=l.a(r,r.objects.collection);if("FeatureCollection"!=o.type)throw"The layer was not in a TopoJSON featurecollection format: "+e.Name;var s=t.append("g").selectAll("."+e.File).data(o.features).enter().append("path").attr("d",n);i.then(function(e){s.attr("fill",function(t){return Object(c.isNullOrUndefined)(t.properties)?"black":"#"+d.getColour(e,t.properties.name)})},function(e){var t=a.k().domain([1,length]).interpolate(a.f).range([a.i("#a6a6a6"),a.i("#f2f2f2")]);s.attr("fill",function(e){return t(Math.random())})})})},this.zoomed=function(){a.b.transform,n._layers.Data.style("stroke-width",1.5/a.b.transform.k+"px"),n._layers.Data.attr("transform",a.b.transform),n._zoomLevel!=a.b.transform.k&&(n._zoomLevel=a.b.transform.k,n.redraw(n._data))},this.redraw=function(e){var t=n._svg.node();switch(t instanceof SVGElement&&n._svg.attr("width",t.clientWidth).attr("height",t.clientHeight),n._layers.Data.selectAll("g").remove(),n._data=e,n._symbology){case Symbology.PointClustered:var r=f.generatePieData(n._data,n._zoomLevel,1,n._config.MaxPieSize,n._config.ClusterDistance,n._config.DisplayUnit);if(0==r.length)break;var a=n._config.DataPalettes.get(n._config.DisplayUnit);if(Object(c.isNullOrUndefined)(a))throw"Configuration error: the data palette is not defined: "+n._config.DisplayUnit;p.drawCategoricalLegend(a,n._svg),n.displayPies(r,n._layers.Data,n._projection,n._config.DataPalettes["Cool Palette"],n._config.DisplayUnit),n._svg.call(n._zoom);break;case Symbology.PointIndividual:throw"Not implemented"}},this.selectedPoints=function(){return n._selectedPoints},this.displayPies=function(e,t,i,s,l){var c=n,u=a.h().value(function(e){return e.Total}).sort(null),p=a.a().outerRadius(function(e){return e.Data.Radius/n._zoomLevel}).innerRadius(0),f=a.a().innerRadius(function(e){return e.Data.Radius/this._zoomLevel}).outerRadius(function(e){return(e.Data.Radius+1)/this._zoomLevel}),h=t.selectAll("g").data(e).enter().append("g").attr("transform",function(e){return"translate("+i([e.Centroid.geometry.coordinates[0],e.Centroid.geometry.coordinates[1]])+")"}).attr("class","pies marker").on("click",function(e){o(c).trigger(r.SELECTED_POINTS),c._selectedPoints=e.DataPoints});h.selectAll("path").data(function(e){return u(e.Categories)}).enter().append("path").attr("d",p).attr("fill",function(e,t){return void 0!=s?"#"+d.getColour(e.data.Categories,s[l]):"black"}),h.selectAll("path.outline").data(function(e){return u(e.Categories)}).enter().append("path").attr("d",f).attr("fill","black")},this._config=t,this._svg=a.m("#"+e),Object(c.isNullOrUndefined)(this._svg))throw Error("The specified map container does not exist");this._symbology=t.DisplayMode;var s=o("#"+e).width(),h=o("#"+e).height();if(Object(c.isNullOrUndefined)(s)||Object(c.isNullOrUndefined)(h))throw Error("The height and width of the map element could not be computed");this._svg.attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(s,h)+" "+Math.min(s,h)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+Math.min(s,h)/2+","+Math.min(s,h)/2+")");var m=this._svg.append("g");this._layers={BackgroundLayers:m.append("g"),Data:m.append("g")},this._projection=u.create(t.Projection,t.MapCentre,t.MapZoomLevel),this._zoom=a.o().scaleExtent([1,4]).on("zoom",this.zoomed),this._zoomLevel=1,this._selectedPoints=[];var g=a.e().projection(this._projection);this.loadBaseLayers(g)}}();!function(e){(u||(u={})).create=function(e,t,n){switch(void 0==n&&(n=1),void 0==t&&(t=[45,45]),name){case Projection.Arctic:return a.d().scale(600*n).translate([500,350]).clipAngle(90).rotate([0,-90]).precision(0);case Projection.Standard:return a.c().center(t).scale(150*n)}return a.c().center(t).scale(150*n)}}(),function(e){(d||(d={})).getColour=function(e,t){var n=e.get(t);return Object(c.isNullOrUndefined)(n)?"black":n}}(),function(e){(p||(p={})).drawCategoricalLegend=function(e,t){t.empty();var n=[],r=[],i=[];e.forEach(function(e,t){n.push(e),r.push(e),i.push({Key:t,Value:e})});var o=17.5*r.length;t.attr("height",o);var s=a.j().domain(n).range([6,o+6]);t.append("g").selectAll("circle").data(i).enter().append("circle").attr("cx",6).attr("cy",function(e){var t=s(e.Key);return void 0!=t?6+t:6}).attr("r",5).attr("stroke","black").attr("fill",function(e){return"#"+e.Value}),t.append("g").selectAll("text").data(i).enter().append("text").attr("x",15).attr("y",function(e){var t=s(e.Key);return void 0!=t?10+t:10}).text(function(e){return e.Key})}}(),function(e){function t(e,t){var n=0,r=function(e,a){var o={type:"Feature",properties:e[0],geometry:{type:"Point",coordinates:[e[0].LonDD,e[0].LatDD]}},l=i.filter(e,function(e){var n={type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.LonDD,e.LatDD]}};return s.distance(o,n,"kilometers")<t}),c=s.featureCollection(i.map(l,function(e){return{type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.LonDD,e.LatDD]}}})),u={Centroid:s.centroid(c),Points:l};a.push(u);var d=i.difference(e,l);return++n>1e4?(console.log(a),console.log(d),a):d.length>0?r(d,a):a};return r(e,[])}e.generatePieData=function(e,n,r,o,s,l){if(0==e.length)return[];var c=t(i.sortBy(e,l),s-(n-1)/3*(s-1)),u=a.l().domain([0,o]).range([3.5,25.5]).exponent(1),d=0;return i.map(c,function(e){var t=i.reduce(e.Points,function(e,t){var n=t[l],r=i.where(e,{category:n});if(0==r.length)return e.push({Category:n,Value:1,Radius:0}),e;for(var a={Category:n,Value:r[0].Value++,Radius:0},o=0,s=e.length;o<s;o++)if(e[o].Category==a.Category){e[o]=a;break}return e},[]),n=0;t.forEach(function(e){n+=e.Value}),n>d&&(d=n);var r=u(n);return t.forEach(function(e){e.Radius=r}),{Centroid:e.Centroid,Categories:t,Total:n,DataPoints:e.Points}})},e.cluster=t}(f||(f={})),n.d(t,"ThallooViewModel",function(){return v}),function(e){e[e.STANDARD=1]="STANDARD",e[e.FULLSCREEN=2]="FULLSCREEN"}(h||(h={}));var g,v=function(){return function(e){var t=this;this.config=void 0,this.rawData=[],this.thallooMap=void 0,this.filters=ko.observableArray(),this.slices=ko.observableArray(),this.displayMode=ko.observable(h.STANDARD),this.id=ko.observable(),this.title=ko.observable(),this.description=ko.observable(""),this.descriptionExpanded=ko.observable(!1),this.publication=ko.observable(),this.displayUnit=ko.observable(),this.baselayers=ko.observableArray(),this.logos=ko.observableArray(),this.selectedFilter=ko.observable(),this.selectedFilterValues=ko.observableArray(),this.currentSlice=ko.observable(),this.currentSliceMin=ko.observable(),this.currentSliceMax=ko.observable(),this.stashedFilters=ko.observableArray(),this.stashedSlices=ko.observableArray(),this.selectedPoints=ko.observableArray(),this.toggleFullScreen=function(){t.displayMode()==h.FULLSCREEN?t.displayMode(h.STANDARD):t.displayMode()==h.STANDARD&&t.displayMode(h.FULLSCREEN)},this.toggleDescriptionLength=function(){t.descriptionExpanded(!t.descriptionExpanded())},this.stashFilter=function(){var e=t.selectedFilter();t.stashedFilters.push({Name:e.Name,Unit:e.Unit,Description:e.Description,Options:e.Options,Column:e.Column,DataType:e.DataType,SelectedOptions:t.selectedFilterValues()})},this.removeFilter=function(e){t.stashedFilters.remove(e)},this.stashSlice=function(e,n,r){t.stashedSlices.push({Name:e,Min:n,Max:r})},this.zoomIn=function(){null!=t.thallooMap&&t.thallooMap.zoomIn()},this.zoomOut=function(){null!=t.thallooMap&&t.thallooMap.zoomOut()},this.redrawMap=function(){var e=t,n=[];0==t.selectedFilterValues().length?n=t.rawData:(n=i.filter(t.rawData,function(n){return void 0!=i.find(t.selectedFilterValues(),function(t){return g.stringPresentInSemicolonList(n[e.selectedFilter().Column],t)})}),n=t.rawData),null!=t.currentSlice()&&(n=i(n).chain().filter(function(t){return Number(t[e.currentSlice().Name])<Number(e.currentSliceMax())&&Number(t[e.currentSlice().Name])>Number(e.currentSliceMin())}).value()),t.stashedFilters().forEach(function(e){n=i.filter(n,function(t){return i.contains(e.SelectedOptions,t[e.Name])})}),null!=t.thallooMap&&t.thallooMap.redraw(n)};var n=this;n.selectedFilter.subscribe(function(e){n.selectedFilterValues([]),n.redrawMap()}),n.selectedFilterValues.subscribe(function(e){n.redrawMap()}),n.currentSliceMin.subscribe(function(e){n.redrawMap()}),n.currentSliceMax.subscribe(function(e){n.redrawMap()}),n.stashedFilters.subscribe(function(e){n.redrawMap()}),n.stashedSlices.subscribe(function(e){n.redrawMap()}),n.currentSlice.subscribe(function(e){null!=e?(n.currentSliceMin(e.Min),n.currentSliceMax(e.Max),n.redrawMap()):n.redrawMap()});var o=a.g("../map-data/"+e+".json"),s=a.n("../map-data/"+e+".txt");o.then(function(e){n.config=e,n.thallooMap=new m("map",e),n.baselayers(e.BaseLayers),n.title(e.Name),n.description(e.Description),n.publication(e.Publication),n.displayUnit(e.DisplayUnit),n.logos(e.Logos),$(n.thallooMap).on(r.SELECTED_POINTS,function(){if(void 0!=n.thallooMap){var e=n.thallooMap.selectedPoints(),t=i.map(e,g.objectToKeyValue);n.selectedPoints(t);var r=$("#selected").offset();void 0!=r&&$("html, body").animate({scrollTop:r.top},200)}}),i(e.Fields).map(function(e){if(e.DataType==DataType.Continuous){var t={Min:i.chain(n.rawData).pluck(e.Column).filter(function(e){return!isNaN(parseFloat(e))&&isFinite(e)}).min().value(),Max:i.chain(n.rawData).pluck(e.Column).filter(function(e){return!isNaN(parseFloat(e))&&isFinite(e)}).max().value(),Unit:e.Unit,Name:e.Name};n.slices.push(t)}else if(e.DataType==DataType.Categorical){var r={Options:i.chain(n.rawData).pluck(e.Column).map(function(e){if(void 0!=e)return i.map(e.split(";"),function(e){return e.trim()})}).flatten().filter(function(e){return""!=e}).uniq().sortBy(function(e){return e.toLowerCase()}).value(),Name:e.Name,Unit:e.Unit,Description:e.Description,DataType:e.DataType,Column:e.Column,SelectedOptions:[]};n.filters.push(r)}}),s.then(function(e){n.rawData=i.map(e,g.tryParseDataPoint),n.redrawMap()})})}}();!function(e){e.splitDataBySite=function(e){return i(e["LatDD,LonDD"].split(";")).chain().map(function(e){return e.split(",")}).filter(function(e){return 2==e.length}).map(function(t){var n=e,r={LatDD:t[0].trim(),LonDD:t[1].trim()};return jQuery.extend(n,r)}).value()},e.stringPresentInSemicolonList=function(e,t){var n=i.map(e.split(";"),function(e){return e.trim()});return i.contains(n,t)},e.objectToKeyValue=function(e){var t=Object.keys(e);return i.map(t,function(t){return{key:t,value:e[t]}})},e.tryParseDataPoint=function(e){return e}}(g||(g={}))}}]);