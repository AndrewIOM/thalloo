<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body>
    <div class="container">
        <div class="top-links">
            <a href="{{ site.url }}/" target="_blank" class="top-links-right">acm.im</a>            
            <a href="{{ site.baseurl }}/">&larr; All Evidence Maps</a>
        </div>
        <hr/>

        <h1 id="study-name" data-bind="text: title">Loading...<br/><small id="study-publication"></small></h1>
        <span class="heading-description" data-bind="text: description"></span>
        <hr/>
        <div class="row">
            <div class="nine columns">
                <svg id="map" />

                <!-- Slicer -->
                <h3>Slice</h3>
                <div class="slicer">
                    <label for="slicer">By Dimension</label>
                    <select class="u-full-width" data-bind=" options: slices, optionsCaption: 'None', optionsText: function(item) { return item.name }, value: currentSlice"></select>
                    <div id="slicer" data-bind="slider: currentSlice, sliderOptions: {minValue: 0, max: 100, range: 'min', step: 1"></div>
                </div>
                <div data-bind="visible: currentSlice() != null">
                    <span data-bind="text: currentSliceMin">?</span> -
                    <span data-bind="text: currentSliceMax">?</span>
                    <span data-bind="text: currentSlice() ? currentSlice().unit : ''">?</span>
                    <br/>
                    <button>Stash Slice</button>
                </div>

                <table data-bind="visible: stashedSlices().length > 0">
                    <thead>
                        <tr>
                            <th>Slice</th>
                            <th>Range</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: stashedSlices">
                        <tr>
                            <td data-bind="text: name"></td>
                            <td data-bind="text: lower + ' to ' + upper"></td>
                            <td><button data-bind="click: $parent.removeFilter:">☓</button></td>
                        </tr>
                    </tbody>
                </table>

                <!-- Selected Point(s) -->
                <div data-bind="if: selectedPoints().length > 0">
                        <h3 id="selected"><span data-bind="text: selectedPoints().length"></span> Selected</h3>
                        <ul data-bind="foreach: selectedPoints" class="card-list">
                            <li data-bind="foreach: $data">
                                <dl style="margin-bottom:0">
                                    <dt style="width: 30%;display: inline-block;font-weight: bold;" data-bind="text: key"></dt>
                                    <dd style="width: 50%;display: inline-block;" data-bind="text: value"></dd>
                                </dl>
                            </li>
                        </ul>
                    </div>

            </div>
            <div class="three columns">
                {{ content }}
            
                <p data-bind="text: publication"></p>

                <form id="filter-form" data-bind="submit: stashFilter">
                    <h3>Filter</h3>

                    <label for="exampleRecipientInput">Metadata</label>
                    <select class="u-full-width" data-bind=" options: filters,
                                        optionsText: function(item) { return item.name },
                                        value: selectedFilter"></select>

                    <!-- List of active filters and slices -->
                    <table data-bind="visible: stashedFilters().length > 0">
                        <thead>
                            <tr>
                                <th>Filter</th>
                                <th>Value</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: stashedFilters">
                            <tr>
                                <td data-bind="text: name"></td>
                                <td data-bind="text: value"></td>
                                <td><button data-bind="click: $parent.removeFilter">☓</button></td>
                            </tr>
                        </tbody>
                    </table>

                    <select multiple style="height:15em; width:100%;" data-bind="options: selectedFilter() ? selectedFilter().options : [],
                                   selectedOptions: selectedFilters"></select>
                    <button>Stash Filter</button>
                </form>

                <div>
                    <h3>Symbology</h3>
                    <strong data-bind="text: displayUnit"></strong>
                    <svg id="symbology"></svg>
                </div>

                <div id="details-panel" data-bind="visible: baselayers().length > 0">
                    <h3>Base Layers</h3>
                    <div data-bind="foreach: baselayers">
                        <strong data-bind="text: $data.name"></strong>
                        <p data-bind="text: $data.description"></p>
                    </div>
                </div>
            </div>
        </div>
</body>

<script src="{{ site.baseurl }}/scripts/thalloo-map.js"></script>
<script src="{{ site.baseurl }}/scripts/app.js"></script>
<script>
    var vm = new ThallooViewModel('{{page.mapname}}');
    ko.applyBindings(vm);
    var redrawMap = vm.redrawMap;
</script>
{% include analytics.html %}
</html>
